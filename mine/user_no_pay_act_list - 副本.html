<!DOCTYPE html>
<html>
<head>
<title>我的赛事活动</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
<meta name="distribution" content="global" />
<meta name="author" content="活力圈" />
<meta name="webcrawlers" content="all" />
<link rel="stylesheet" type="text/css" href="../dist/css/hlq.min.css">
<script type="text/javascript" src="../dist/js/sea.js"></script>
<script type="text/javascript" src="../dist/js/sea_config.js"></script>
</head>
<style>
	.tab-nav li a{display:block;color: #777;}
	.tab-nav li.current a{color:#f6443a;}
</style>
<body>
<header class="header">
    <div class="bnt-back" onclick="history.back()"><i class="icon-back"></i></div>
    <h1>未支付</h1>
	<a class="bnt_right" href="../index.html"><span class="icon_home"></span></a>
</header>
<div class="main">
	<div class="panel">
		<div class="tab tab_fixed">
			<ul class="tab-nav">
				<li><a href="user_act_list.html">已报名</a></li>
				<li class="current">未支付</li>
			</ul>
			<div id="list" class="weui_panel_bd"></div>
		</div>
	</div>
</div>
<div id="back_top"></div>
<script type="text/javascript">
var requireFun = ['zepto','base','login','dropload','jweixin'];
seajs.use(requireFun, function(zepto,base,login){
	var session = base.getItem('session'),
		page = 1,
		page_size = 10;
	console.log(base.getItem('session'));

	$('.main').dropload({
		scrollArea : window,
		loadDownFn : function(me){
			$.ajax({
				type: 'GET',
				url: base.userNoPayList,
				data: {
					page_size:page_size,
					page:page,
					session: session
				},
				dataType: 'json',
				success: function(data){
					page++;
					response = data.data.list;
					console.log(response);
					var _html = '';
					if(data.data.list.length < 1){
						me.lock();
						me.noData();
					}
					$('#list').append(_html);
					for(var i = 0; i < response.length; i++){
						var getInfo = base.proGroupInfo(response[i].enroll_type,response[i].project_id,response[i].group_id);
						var href ='../pay/weixin_unifiedorder.html?enroll_id='+ response[i].enroll_id +'&id='+ response[i].org_act_id +'&project_id='+ response[i].project_id +'&group_id='+ response[i].group_id +'&type=';
						//console.log(response[i].enroll_id);
						switch(response[i].enroll_type){
							case 'a': href += 'activity&order='+ getOrder('a',response[i].enroll_id); break;  //活动
							case 'e': href += 'event&order='+ getOrder('e',response[i].enroll_id); break;  //活动
							case 't': href += 'training&order='+ getOrder('t',response[i].enroll_id); break;  //活动
						};
					_html +='<a  href="'+ href +'" id="'+ response[i].enroll_id +'" class="weui_media_box weui_media_appmsg list">' +
							'<div class="weui_media_hd"><img alt="" src="' + base.imgURL + response[i].logo_image + '@150h_150w_1e_1c_10-2ci" class="weui_media_appmsg_thumb"></div>'+
							'<div class="weui_media_bd">'+
							'<h4 class="title">'+ response[i].title +'</h4>' +
							'<p class="weui_media_desc group">项目：'+ getInfo.data.project +'</p><p class="weui_media_desc group">组别：'+ getInfo.data.group +'</p></div><div class="weui_cell_ft"><span class="price">¥<em>'+ parseFloat(response[i].amount,10) +'</em>元</span></div></a>';
					};
					$('#list').append(_html);
					me.resetload();
				},
				error: function(xhr, type){
					base.tips("网络有点卡");
				}
			});
		}
	});

	function getOrder(type,id){
		var id = '['+id+']',order = '';
		switch(type){
			case 'a': var url = base.activityEnrollSelect; var data={activity_enroll_id_params:id,session : session};  break;
			case 'e': var url = base.eventEnrollSelect; var data={event_enroll_id_params:id,session : session};  break;
			case 't': var url = base.trainingEnrollSelect; var data={training_enroll_id_params:id,session : session};  break;
		};
		$.ajax({
			type:'POST',
			url:url,
			data:data,
			dataType:'json',
			async: false,
			success : function(data){
				order = data.data.order_no
			},
			error:function(xhr){
				console.log(xhr)
			}
		});
		return order
	};



	//禁止微信
	//require('jweixin')
	base.hideOptionMenuWx();

});
</script>
</body>
</html>
